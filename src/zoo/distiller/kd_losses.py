import torch
import torch.nn.functional as F



def kl_div_loss(logits_student, logits_teacher, temperature):

    log_pred_student = F.log_softmax(logits_student / temperature, dim=1)
    pred_teacher = F.softmax(logits_teacher / temperature, dim=1)
    loss_kd = F.kl_div(log_pred_student, pred_teacher, reduction="none")
    loss_kd *= temperature**2

    return loss_kd